<!DOCTYPE html>
<html>

<head>
    <title>Neural Twin ® Viewer</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>

    <h1 class="title neon">Neural Twin ® Viewer</h1>

    <div class="viewport_container">
        <h1 id="keypressed" class="keypress neon"></h1>
        <canvas class="viewport" id="viewport" width="800" height="600">

        </canvas>
        <!-- <div class="cover">
            Load Twin
        </div> -->
    </div>

    <script>
        var ws = new WebSocket("ws://localhost:8000/ws");
        ws.binaryType = "arraybuffer";

        ws.onopen = function (e) {
            console.log("[open] Connection established");
        };
        ws.onmessage = function (event) {
            const arrayBuffer = event.data;
            let base_image = new Image();
            base_image.src = 'data:image/jpg;base64,' + arrayBuffer;

            var canvas = document.getElementById('viewport'),
                context = canvas.getContext('2d');
            base_image.onload = function () {
                context.drawImage(base_image, 0, 0, 800, 800);
            }
        };


        setInterval(function () {
            ws.send('')
        }, 10);

        window.addEventListener('keydown', this.keydown, false);
        window.addEventListener('keyup', this.keyup, false);

        function keydown(e) {
            var key = String.fromCharCode(e.keyCode);
            document.getElementById("keypressed").innerHTML = key;
            ws.send(key);
        }
        function keyup(e) {
            document.getElementById("keypressed").innerHTML = '';
        }

    </script>
</body>

</html>